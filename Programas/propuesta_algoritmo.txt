** Planteo del problema:

    A continuación se obtendrá el perfil de temperaturas en estado estacionario
    de una barra de metal.
    La ecuación diferencial que representa este problema simple es la siguiente:

    d^2u/dx^2 = 0,
        Condiciones de borde u(1)=100 y u(M)=0.
        Condiciones iniciales u(2:M-1)=0

    La solución a esta ecuación simple se realiza de forma numérica,
    por el método de las diferencias finitas.
    
    La solución analítica a este problema es la recta que pasa por los puntos (1,100) y (M,0)

** Código Matlab/Octave.

  clear all;
  % Inicializo el vector de temperaturas
  M = 100;
  u(1) = 100;
  u(2:M) = 0;

  % Iteración principal
  N = 3000;
  for( k = 1 : N )
	  % Sub Iteración
	  for( i = 2 : M - 1 )
		  u(i)=( u(i+1) + u(i-1) ) / 2;
	  end
  end
  plot(u);
  
    
** Código en la máquina simple ampliada:
    
Para implementar este extracto de código necesito Load (LD) para traerme valores de la memoria
y shift right (SHR) para dividir por dos.

; Reinicio la UART
OUT 5,0

; Inicialización...
MOV @100,N
MOV @15,M
MOV @0,k

; Comienza iteración principal
MainIt: CMP k,N
	
	; Si terminé de iterar voy al final del programa
		BEQ EndMainIt

	; Inicializo los punteros al comienzo del arreglo
		MOV Data,u_prev_ptr
		MOV Data,u_curr_ptr
		MOV Data,u_next_ptr
		ADD @1,u_curr_ptr
		ADD @1,u_next_ptr
		ADD @1,u_next_ptr

	; Inicializo i = 2
		MOV @0,i

	; Comienza la subiteración
		SubIt: CMP i,M
		BEQ EndSubit

		; Obtengo valores apuntados, u_prev = u(i-1) y u_next = u(i+1)
			LEA u_prev_ptr,u_prev
			LEA u_next_ptr,u_next
			
		; Imprimo puntero para debug
		WaitUntilNotFullUart:
			IN 6,z
			CMP @1,z
			BEQ WaitUntilNotFullUart
		OUT 4,u_prev_ptr
		OUT 4,@32

		; Promedio, u(i) = ( u(i+1) + u(i-1) ) / 2
		 MOV u_prev,res
			ADD u_next,res
			SHR res,1
			MOV res,[u_curr_ptr]

		; Incremento subiteración
			ADD @1,i

		; Actualizo punteros u(i-1), u(i) y u(i+1)
			ADD @1,u_prev_ptr
			ADD @1,u_curr_ptr
			ADD @1,u_next_ptr

		; Salto al principio del ciclo: SubIt
			CMP @0,@0
			BEQ SubIt

	EndSubit:

	; Incremento iteración principal
		ADD @1,k

	; Salto al principio del ciclo: SubIt
		CMP @0,@0
		BEQ MainIt

EndMainIt:
	JMP EndMainIt

Data:	DW 25600
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0
	DW 0

